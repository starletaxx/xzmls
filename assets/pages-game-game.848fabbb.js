import{m as t,p as e,q as i,s,o as a,c as n,w as l,n as r,u as o,i as c,a as h,v as d,x as u,y as m}from"./index-c2717d43.js";import{_ as p,M as x}from"./_plugin-vue_export-helper.8bd8d0fb.js";const f={left:"LEFT",right:"RIGHT",down:"DOWN",up:"UP",click:"CLICK",leftAndUp:"LEFT_UP",leftAndDown:"LEFT_DOWN",rightAndUp:"RIGHT_UP",rightAndDown:"RIGHT_DOWN"},g=f,y=t=>{const{a:e,b:i}=t;if(null!=e&&null!=i){const t=e.x-i.x,s=e.y-i.y,a=Math.abs(t),n=Math.abs(s);if(a<n)return e.y>i.y?f.up:f.down;if(a>n)return e.x>i.x?f.left:f.right;if(0!=a)return t>0?s>0?f.leftAndUp:f.leftAndDown:s>0?f.rightAndUp:f.rightAndDown}return f.click},w=""+new URL("ss-58b991cf.png",import.meta.url).href,T=""+new URL("dialog-e990a986.png",import.meta.url).href,I=""+new URL("musicicon-07d1f7a8.png",import.meta.url).href,M=t();M.autoplay=!0,M.loop=!0,M.src="/static/yatou.MP3";const v=p({data:()=>({muteBgMusic:!0}),onLoad(t){(null==t?void 0:t.map)&&(this.mapid=t.map)},watch:{muteBgMusic(t,e){t?this.$music.playBgm({mute:!0}):this.$music.playBgm({mute:!1})}},onUnload(){this.closeTimer()},onReady(){e().select("#canv").fields({size:!0},(t=>{this.canvasData={canvas:{width:t.width,height:t.height,requestAnimationFrame(t){window.requestAnimationFrame((()=>t()))}},ctx:i("canv")};const e=(new x).getMap(this.mapid||0),{cols:s}=e,a=Math.floor(e.data.length/s),n=Math.floor(t.width/s),l=(t.width-n*s)/2,r=[];for(let i=0;i<a;i++)for(let t=0;t<s;t++){let a={x:t*n+l,y:i*n+100,i:i*s+t};r.push(a),a.a=e.data[a.i]}this.map={paddingTop:100,paddingLeft:l,grids:r,size:n,rows:a,cols:s,inIndex:e.inIndex,outIndex:e.outIndex,player:{index:e.inIndex}},this.map.player.headImgs=["/static/tt.png","/static/player-2.png","/static/player-2.png"],this.restart()})).exec()},methods:{playMusic(){this.muteBgMusic=!this.muteBgMusic},onTouchStart(t){const e=t.touches[0];this.startPoint=e},onTouchMove(t){const e=t.touches[0];this.endPoint=e},onTouchEnd(){if(this.isGameEnd)return;const{startPoint:t,endPoint:e}=this,i=g,s=y({a:t,b:e}),{grids:a,player:n,cols:l}=this.map;let r;switch(s){case i.left:r=a[n.index-1];break;case i.up:r=a[n.index-l];break;case i.right:r=a[n.index+1];break;case i.down:r=a[n.index+l]}r&&"1"!=r.a&&(this.preIndex=n.index,n.index=r.i,this.redraw())},closeTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)},restart(){this.timer&&this.closeTimer();const{player:t,inIndex:e,outIndex:i}=this.map;t.index=e,t.timer=60;const{canvas:a}=this.canvasData;this.timerNum=0,this.isGameEnd=!1,this.preIndex=e,this.pulseSize=1,this.pulseDire=1;const n=()=>{this.timer=setTimeout((()=>{if(t.timer<=0)this.showModal("你还没找到莎莎，你是假的大头\n让真大头来！");else{if(t.index==i)return s({title:"找到莎莎啦",content:"你哪也甭去\n这里是新加坡,不是上海,别瞎跑\n听见没",showCancel:!1,confirmText:"返回首页",success:t=>{t.confirm&&r({url:"/pages/index/index"})}}),void(this.isGameEnd=!0);t.index==e&&this.preIndex!=e&&(this.preIndex=e,o({image:"/static/ttangery.png",title:"莎莎在等你\n别回去",icon:"none"})),this.timerNum+=60,this.redraw((()=>a.requestAnimationFrame((()=>n()))))}}),60)};n()},redraw(t){const{map:e}=this,{canvas:i,ctx:s}=this.canvasData,{player:a,grids:n,size:l,rows:r,cols:o,paddingTop:c,paddingLeft:h,outIndex:d}=e;if(a.index==d)this.drawMaze(0,0);else{let t=a.index,e=n[t-o-1];null==e&&(e=n[t-1]),null==e&&(e=n[t-o]),null==e&&(e=n[a.index]),s.fillStyle="#000000",s.rect(h,c,o*l,r*l),s.fill();let i=3*l;this.drawMaze(0,0,e.x,e.y,i,i),s.fillStyle="rgba(0, 0, 0, 0)",i=l/1,s.beginPath(),s.rect(e.x,e.y,i,i),s.fill(),s.beginPath(),s.rect(e.x+2*i,e.y+2*i,2*i,2*i),s.fill(),s.beginPath(),s.rect(e.x+2*i,e.y,i,i),s.fill(),s.beginPath(),s.rect(e.x,e.y+2*i,i,i),s.fill()}let u=n[a.index],m=d!=a.index;if(this.isGameEnd)m?s.drawImage(a.headImgs[1],u.x,u.y,l,l):s.drawImage(a.headImgs[2],u.x,u.y,l,l);else{s.drawImage(a.headImgs[0],u.x,u.y,l,l);let t=l/2;const e=10;this.pulseSize+=this.pulseDire;let i=this.pulseSize/e;this.pulseSize<2?this.pulseDire=1:this.pulseSize>=e&&(this.pulseDire=-1),u=n[d],s.fillStyle="#F4E286",s.beginPath(),s.arc(u.x+t,u.y+t,t*i,0,2*Math.PI),s.fill()}let p=60-Math.floor(this.timerNum/1e3);p!=a.timer&&(a.timer=p),s.fillStyle="#EEE5DE",s.font="14rpx 华文隶书",s.fillText(`赶紧找到莎莎一起登机吧    倒计时${a.timer}s`,1*h,.95*c),s.draw(!1,t)},drawMaze(t,e,i,s,a,n){const{canvas:l,ctx:r}=this.canvasData,{grids:o,paddingLeft:c,paddingTop:h,size:d,cols:u,rows:m}=this.map;null==a&&(a=d*u),null==n&&(n=d*m),r.fillStyle="#666666",r.beginPath(),null==i&&(i=0),null==s&&(0==t&&(t=c),0==e&&(e=h),i=t,s=e),r.rect(i,s,a,n),r.fill(),r.fillStyle="#333333",o.forEach((t=>{t.x>=i&&t.y>=s&&t.x<i+a&&t.y<s+n&&"1"==t.a&&(r.beginPath(),r.rect(t.x,t.y,d,d),r.fill())}))},showModal(t){this.timer=0,this.redraw(),s({title:"回国航班起飞了...",content:t,confirmText:"重新开始",showCancel:!1,complete:t=>{t.confirm&&this.restart()}})}}},[["render",function(t,e,i,s,r,o){const p=c,x=m;return a(),n(p,null,{default:l((()=>[h(x,{class:"canvas","canvas-id":"canv",id:"canv","disable-scroll":"false",onTouchstart:o.onTouchStart,onTouchmove:o.onTouchMove,onTouchend:o.onTouchEnd,onTouchcancel:o.onTouchEnd},{default:l((()=>[h(p,{class:"ss"},{default:l((()=>[d("img",{src:w,style:{width:"128rpx",height:"150rpx"}}),d("img",{src:T,style:{width:"400rpx",height:"150rpx"}})])),_:1}),h(p,{class:"musicicon"},{default:l((()=>[d("img",{src:I,style:{width:"150rpx",height:"150rpx","border-radius":"50%"},alt:"",class:u([r.muteBgMusic?"":"music"]),onClick:e[0]||(e[0]=(...t)=>o.playMusic&&o.playMusic(...t))},null,2)])),_:1})])),_:1},8,["onTouchstart","onTouchmove","onTouchend","onTouchcancel"])])),_:1})}],["__scopeId","data-v-a3df2294"]]);export{v as default};
